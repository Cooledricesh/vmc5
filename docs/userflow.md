# 유저플로우: 맛집 리뷰 플랫폼

## 1. 메인 페이지 로딩 및 지도 표시

### 입력
- 사용자가 애플리케이션에 접속

### 처리
1. 네이버 지도 SDK 초기화
2. 기본 위치 (예: 서울 중심)로 지도 설정
3. 데이터베이스에서 리뷰가 존재하는 모든 장소 조회
4. 조회된 장소들의 좌표 정보 추출
5. 각 장소 위치에 마커 생성 및 지도에 표시
6. 검색창 UI 렌더링

### 출력
- 네이버 지도가 표시된 메인 페이지
- 리뷰가 있는 장소들에 마커 표시
- 상단 검색창 표시

### 엣지케이스
- **네이버 지도 SDK 로딩 실패**: 에러 메시지 표시 및 재시도 버튼 제공
- **리뷰 데이터 조회 실패**: 빈 지도 표시 및 에러 로깅
- **위치 정보가 없는 리뷰**: 해당 리뷰는 마커 표시에서 제외
- **브라우저가 지도 API를 지원하지 않음**: 대체 UI 또는 안내 메시지 표시

---

## 2. 장소 검색

### 입력
- 사용자가 검색창에 장소명 입력
- 검색 버튼 클릭 또는 Enter 키 입력

### 처리
1. 입력된 검색어 유효성 검사 (빈 문자열 또는 공백만 있는지 확인)
2. 네이버 검색 API에 검색 요청 전송
3. API 응답 수신 및 파싱
4. 검색 결과 데이터 포맷팅
5. 검색 결과 팝업 생성 및 렌더링

### 출력
- 검색 결과 팝업 표시
- 검색된 장소 목록 (장소명, 주소, 카테고리 등 정보 포함)
- 각 검색 결과 항목 클릭 가능

### 엣지케이스
- **빈 검색어 입력**: 검색 실행하지 않고 안내 메시지 표시
- **검색 결과 없음**: 결과 없음 메시지 표시
- **API 호출 실패**: 에러 메시지 표시 및 재시도 옵션 제공
- **API 응답 지연**: 로딩 인디케이터 표시
- **API Rate Limit 초과**: 일시적 사용 제한 안내 메시지 표시
- **네트워크 연결 끊김**: 연결 오류 메시지 표시

---

## 3. 검색 결과에서 장소 선택

### 입력
- 사용자가 검색 결과 팝업에서 특정 장소 클릭

### 처리
1. 선택된 장소의 좌표 정보 추출
2. 지도 중심을 선택된 장소 위치로 이동
3. 적절한 줌 레벨로 조정
4. 선택된 장소 정보 저장 (임시 상태 관리)
5. 검색 결과 팝업 닫기
6. 리뷰 작성 버튼 표시

### 출력
- 지도가 선택된 장소로 이동 및 줌인
- 검색 결과 팝업 닫힘
- 선택된 장소에 강조 마커 또는 인포윈도우 표시
- 리뷰 작성 버튼 표시

### 엣지케이스
- **좌표 정보 없음**: 주소를 좌표로 변환 시도, 실패 시 에러 메시지
- **지도 이동 실패**: 에러 로깅 및 사용자에게 안내
- **장소 정보 불완전**: 필수 정보(장소명, 주소)만 있으면 진행, 부족 시 안내 메시지

---

## 4. 리뷰 작성 페이지 진입

### 입력
- 사용자가 리뷰 작성 버튼 클릭

### 처리
1. 현재 선택된 장소 정보 확인
2. 리뷰 작성 페이지로 라우팅
3. 장소 정보 (장소명, 주소 등) 표시
4. 리뷰 입력 폼 렌더링
   - 별점 선택 UI (1-5점, 0.5점 단위)
   - 리뷰 텍스트 입력창
   - 닉네임 입력 필드
   - 4자리 숫자 비밀번호 입력 필드
   - 저장 버튼

### 출력
- 리뷰 작성 페이지 표시
- 선택된 장소 정보 표시
- 입력 폼 표시

### 엣지케이스
- **선택된 장소 정보 없음**: 메인 페이지로 리다이렉트 및 안내 메시지
- **페이지 로딩 실패**: 에러 메시지 및 재시도 옵션

---

## 5. 리뷰 저장

### 입력
- 사용자가 리뷰 작성 폼 작성 완료
  - 별점 선택 (1-5점, 0.5점 단위)
  - 리뷰 텍스트 입력
  - 닉네임 입력
  - 4자리 숫자 비밀번호 입력
- 저장 버튼 클릭

### 처리
1. 입력 데이터 유효성 검사
   - 별점 선택 여부 확인
   - 닉네임 입력 확인 (빈 문자열 또는 공백만 있는지)
   - 비밀번호 4자리 숫자 형식 확인
   - 리뷰 텍스트는 선택사항 (빈 값 허용)
2. 비밀번호 해싱 처리
3. 리뷰 데이터 객체 생성
   - 장소 ID (네이버 place ID)
   - 장소명
   - 주소
   - 좌표 정보
   - 별점
   - 리뷰 텍스트
   - 닉네임
   - 해싱된 비밀번호
   - 작성일시 (서버 타임스탬프)
4. 데이터베이스에 리뷰 저장
5. 저장 성공 시 장소 세부정보 페이지로 리다이렉트

### 출력
- 저장 성공 시: 장소 세부정보 페이지로 이동
- 저장 실패 시: 에러 메시지 표시 및 폼 유지

### 엣지케이스
- **필수 필드 누락**: 해당 필드 하이라이트 및 안내 메시지
- **비밀번호 형식 오류** (4자리 숫자 아님): 형식 오류 안내 메시지
- **닉네임 길이 제한 초과**: 최대 길이 안내 및 입력 제한
- **리뷰 텍스트 길이 제한 초과**: 최대 길이 안내 및 입력 제한
- **데이터베이스 저장 실패**: 에러 메시지 및 재시도 옵션
- **중복 리뷰 작성**: 동일 닉네임으로 같은 장소에 리뷰 작성 허용 (제한 없음)
- **네트워크 오류**: 연결 오류 메시지 및 재시도 옵션

---

## 6. 마커 클릭 시 장소 세부정보 페이지 이동

### 입력
- 사용자가 메인 페이지 지도에서 마커 클릭

### 처리
1. 클릭된 마커의 장소 ID 추출
2. 장소 세부정보 페이지로 라우팅 (장소 ID를 URL 파라미터로 전달)

### 출력
- 장소 세부정보 페이지로 이동

### 엣지케이스
- **장소 ID 없음**: 에러 로깅 및 메인 페이지 유지
- **라우팅 실패**: 에러 메시지 표시

---

## 7. 장소 세부정보 페이지 로딩

### 입력
- 장소 세부정보 페이지 접근 (URL 파라미터로 장소 ID 전달)

### 처리
1. URL에서 장소 ID 추출
2. 데이터베이스에서 해당 장소의 모든 리뷰 조회
3. 조회된 리뷰 데이터 가공
   - 평균 별점 계산
   - 리뷰 목록 정렬 (최신순)
4. 장소 기본 정보 조회 (장소명, 주소 등)
5. 페이지 렌더링
   - 장소 정보 표시
   - 평균 별점 표시
   - 리뷰 목록 표시 (각 리뷰: 닉네임, 별점, 텍스트, 작성일시)
   - 각 리뷰에 수정/삭제 버튼 표시
   - 리뷰 작성 버튼 표시

### 출력
- 장소 세부정보 페이지 표시
- 장소 정보 및 평균 별점
- 리뷰 목록

### 엣지케이스
- **장소 ID 누락**: 메인 페이지로 리다이렉트 및 안내 메시지
- **리뷰 없음**: 평균 별점 표시하지 않고, 리뷰 없음 메시지 표시
- **데이터베이스 조회 실패**: 에러 메시지 및 재시도 옵션
- **장소 정보 불완전**: 가능한 정보만 표시, 필수 정보 없으면 에러 처리

---

## 8. 리뷰 수정 시작

### 입력
- 사용자가 장소 세부정보 페이지에서 특정 리뷰의 수정 버튼 클릭

### 처리
1. 인증 다이얼로그 표시
2. 사용자 입력 대기
   - 닉네임 입력 필드
   - 4자리 숫자 비밀번호 입력 필드
   - 확인 및 취소 버튼

### 출력
- 인증 다이얼로그 표시

### 엣지케이스
- **다이얼로그 렌더링 실패**: 에러 로깅 및 페이지 새로고침 유도

---

## 9. 리뷰 수정 인증 및 수정 페이지 진입

### 입력
- 사용자가 인증 다이얼로그에서 닉네임과 비밀번호 입력 후 확인 버튼 클릭

### 처리
1. 입력된 닉네임과 비밀번호 유효성 검사
2. 비밀번호 해싱 처리
3. 데이터베이스에서 해당 리뷰의 저장된 닉네임 및 해싱된 비밀번호와 비교
4. 인증 성공 시:
   - 다이얼로그 닫기
   - 리뷰 수정 페이지로 라우팅 (리뷰 ID를 파라미터로 전달)
   - 기존 리뷰 데이터 로딩
   - 수정 폼에 기존 데이터 채우기
5. 인증 실패 시:
   - 에러 메시지 표시
   - 다이얼로그 유지

### 출력
- 인증 성공: 리뷰 수정 페이지로 이동, 기존 리뷰 데이터 표시
- 인증 실패: 에러 메시지 표시

### 엣지케이스
- **필드 누락**: 해당 필드 안내 메시지
- **비밀번호 형식 오류**: 형식 오류 안내
- **인증 실패**: 닉네임 또는 비밀번호 불일치 안내 메시지
- **데이터베이스 조회 실패**: 에러 메시지 및 재시도 옵션
- **리뷰 데이터 없음**: 리뷰가 이미 삭제되었음을 안내하고 페이지 새로고침

---

## 10. 리뷰 수정 저장

### 입력
- 사용자가 리뷰 수정 페이지에서 내용 수정
  - 별점 변경
  - 리뷰 텍스트 변경
- 저장 버튼 클릭

### 처리
1. 수정된 데이터 유효성 검사
   - 별점 선택 여부
   - 리뷰 텍스트는 선택사항
2. 수정 데이터 객체 생성
   - 별점
   - 리뷰 텍스트
   - 수정일시 (서버 타임스탬프)
3. 데이터베이스에서 해당 리뷰 업데이트
4. 저장 성공 시 장소 세부정보 페이지로 리다이렉트

### 출력
- 저장 성공: 장소 세부정보 페이지로 이동, 수정된 리뷰 표시
- 저장 실패: 에러 메시지 및 폼 유지

### 엣지케이스
- **필수 필드 누락**: 해당 필드 안내 메시지
- **데이터베이스 업데이트 실패**: 에러 메시지 및 재시도 옵션
- **네트워크 오류**: 연결 오류 메시지 및 재시도
- **리뷰가 이미 삭제됨**: 리뷰 삭제됨 안내 및 장소 세부정보 페이지로 리다이렉트

---

## 11. 리뷰 삭제 시작

### 입력
- 사용자가 장소 세부정보 페이지에서 특정 리뷰의 삭제 버튼 클릭

### 처리
1. 인증 다이얼로그 표시
2. 사용자 입력 대기
   - 닉네임 입력 필드
   - 4자리 숫자 비밀번호 입력 필드
   - 확인 및 취소 버튼

### 출력
- 인증 다이얼로그 표시

### 엣지케이스
- **다이얼로그 렌더링 실패**: 에러 로깅 및 페이지 새로고침 유도

---

## 12. 리뷰 삭제 인증 및 삭제 처리

### 입력
- 사용자가 인증 다이얼로그에서 닉네임과 비밀번호 입력 후 확인 버튼 클릭

### 처리
1. 입력된 닉네임과 비밀번호 유효성 검사
2. 비밀번호 해싱 처리
3. 데이터베이스에서 해당 리뷰의 저장된 닉네임 및 해싱된 비밀번호와 비교
4. 인증 성공 시:
   - 삭제 확인 다이얼로그 추가 표시 (실수 방지)
   - 사용자가 최종 확인 시 데이터베이스에서 리뷰 삭제
   - 삭제 성공 시 페이지 새로고침 또는 리뷰 목록 업데이트
5. 인증 실패 시:
   - 에러 메시지 표시
   - 다이얼로그 유지

### 출력
- 인증 성공 및 삭제 확인: 리뷰 삭제 후 장소 세부정보 페이지 새로고침
- 인증 실패: 에러 메시지 표시
- 삭제 취소: 다이얼로그 닫기

### 엣지케이스
- **필드 누락**: 해당 필드 안내 메시지
- **비밀번호 형식 오류**: 형식 오류 안내
- **인증 실패**: 닉네임 또는 비밀번호 불일치 안내 메시지
- **데이터베이스 삭제 실패**: 에러 메시지 및 재시도 옵션
- **리뷰 데이터 없음**: 리뷰가 이미 삭제되었음을 안내하고 페이지 새로고침
- **마지막 리뷰 삭제**: 삭제 후 리뷰 없음 상태로 페이지 업데이트, 평균 별점 제거

---

## 13. 장소 세부정보 페이지에서 새 리뷰 작성

### 입력
- 사용자가 장소 세부정보 페이지에서 리뷰 작성 버튼 클릭

### 처리
1. 현재 장소 정보 확인
2. 리뷰 작성 페이지로 라우팅 (장소 정보를 파라미터로 전달)
3. 리뷰 작성 폼 렌더링 (유저플로우 4, 5와 동일)

### 출력
- 리뷰 작성 페이지로 이동

### 엣지케이스
- **장소 정보 없음**: 메인 페이지로 리다이렉트 및 안내 메시지

---

## 전체 시스템 공통 엣지케이스

### 브라우저 호환성
- **브라우저가 필수 기능 미지원**: 지원하지 않는 브라우저 안내 메시지 표시

### 세션 관리
- **페이지 새로고침 시 임시 데이터 손실**: 필요한 경우 localStorage 또는 sessionStorage 활용

### 동시성 처리
- **여러 사용자가 동시에 같은 리뷰 수정/삭제 시도**: 낙관적 잠금 또는 최종 작성 시간 확인

### 데이터 정합성
- **장소 정보 변경 (네이버 API 업데이트)**: 기존 리뷰는 작성 시점의 장소 정보 유지

### 보안
- **SQL Injection 방어**: 파라미터화된 쿼리 사용
- **XSS 방어**: 사용자 입력 데이터 이스케이프 처리
- **비밀번호 보안**: 해싱 알고리즘 사용 (bcrypt 등)
